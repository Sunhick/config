#+TITLE: settings
#+DATE: <2018-01-21 Sun>
#+AUTHOR: Sunil
#+EMAIL: sunhick@gmail.com
#+OPTIONS: ':nil *:t -:t ::t <:t H:3 \n:nil ^:t arch:headline
#+OPTIONS: author:t c:nil creator:comment d:(not "LOGBOOK") date:t
#+OPTIONS: e:t email:nil f:t inline:t num:t p:nil pri:nil stat:t
#+OPTIONS: tags:t tasks:t tex:t timestamp:t toc:t todo:t |:t
#+CREATOR: Emacs 25.3.1 (Org mode 8.2.10)
#+DESCRIPTION: Emacs init.el alternative using org mode
#+EXCLUDE_TAGS: noexport
#+KEYWORDS: init.el org-mode settings emacs
#+LANGUAGE: en
#+SELECT_TAGS: export
#+STARTUP: showeverything

* Emacs configuration settings
*** File Header
    #+BEGIN_SRC emacs-lisp

      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
      ;; 
      ;; settings.el - AUTO GENERATED FILE
      ;; 
      ;; Author : Sunil <sunhick@gmail.com>
      ;; Emacs customization file
      ;;
      ;; DO NOT EDIT THIS FILE. IF YOU WANT TO MODIFY
      ;; USE settings.org
      ;; 
      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

    #+END_SRC
    
*** Visual tweaks
    #+BEGIN_SRC emacs-lisp
      ;; Get rid of tool bar and menu bar
      ;; (menu-bar-mode 0)
      ;; Yeah, I'm keeping the text menu at the top. It doesn't
      ;; bother me. Whereas the toolbar i never use it and just
      ;; occupies space.
      (tool-bar-mode 0)
      (scroll-bar-mode 0)

      ;; I hate typing. Especially when emacs prompts
      ;; me with yes/no and i type 'y' or 'n' in a hurry
      ;; remap yes/no to y/n
      (fset 'yes-or-no-p 'y-or-n-p)

      ;; Enable visual line mode
      (global-visual-line-mode 1)

      ;; change the fringe 
      (set-fringe-mode '(nil . 0))

      ;; Trash can support
      (setq delete-by-moving-to-trash t)

      ;; 80 chars is a good width.
      (set-default 'fill-column 80)

      ;; Display line & column numbers
      (setq line-number-mode t)
      (setq column-number-mode t)
      
      ;; use whitespaces instead of tabs
      (setq-default indent-tabs-mode nil)
    #+END_SRC

*** Mac OS tweaks
    #+BEGIN_SRC emacs-lisp
      (when (string= system-type "darwin")       
	(setq dired-use-ls-dired nil))
    #+END_SRC

*** Buffers
    #+BEGIN_SRC emacs-lisp
      (defalias 'list-buffers 'ibuffer)

    #+END_SRC

*** Magit
    #+BEGIN_SRC emacs-lisp
      ;; 
      ;; configure and bind the keystroke for magit.
      ;; 
      (use-package magit
        :ensure t)
      (require 'magit-status)
      (global-set-key(kbd "C-x g") 'magit-status)

      ;; set the magit repository
      (setq magit-repository-directories '( "~/prv/github/"))

    #+END_SRC
    
*** Counsel & Swiper
    #+BEGIN_SRC emacs-lisp
      ;;
      ;; configure swipper for easy searching and navigations.
      ;; counsel is required for the C-x C-f to work. swiper
      ;; does install the counsel but need require line to
      ;; make it work.
      ;; 
      (use-package counsel
        :ensure t)
      (use-package swiper
        :ensure t)
      (use-package counsel-projectile
        :ensure t)
      (require 'counsel)
      (require 'swiper)
      (ivy-mode 1)
      (setq ivy-use-virtual-buffers t)
      (setq enable-recursive-minibuffers t)
      (global-set-key "\C-s" 'swiper)
      (global-set-key (kbd "C-c C-r") 'ivy-resume)
      (global-set-key (kbd "<f6>") 'ivy-resume)
      (global-set-key (kbd "M-x") 'counsel-M-x)
      (global-set-key (kbd "C-x C-f") 'counsel-find-file)
      (global-set-key (kbd "<f1> f") 'counsel-describe-function)
      (global-set-key (kbd "<f1> v") 'counsel-describe-variable)
      (global-set-key (kbd "<f1> l") 'counsel-find-library)
      (global-set-key (kbd "<f2> i") 'counsel-info-lookup-symbol)
      (global-set-key (kbd "<f2> u") 'counsel-unicode-char)
      (global-set-key (kbd "C-c g") 'counsel-git)
      (global-set-key (kbd "C-c j") 'counsel-git-grep)
      (global-set-key (kbd "C-c k") 'counsel-ag)
      (global-set-key (kbd "C-x l") 'counsel-locate)
      (global-set-key (kbd "C-S-o") 'counsel-rhythmbox)
      (define-key read-expression-map (kbd "C-r") 'counsel-expression-history)

      ;; configure projectile
      (projectile-mode)
      (setq projectile-completion-system 'ivy)

    #+END_SRC
    
*** Misc
    #+BEGIN_SRC emacs-lisp
      ;;
      ;; Easy navigations & typing.
      ;;

      ;; configure which key for help on key strokes
      (use-package which-key
        :ensure t)
      (require 'which-key)
      (which-key-mode)

      ;; enable auto pair mode to automatically insert closing parenthesis.
      (use-package autopair
        :ensure t)
      (require 'autopair)
      (autopair-global-mode 1)

      ;; Show matching parenthensis
      (show-paren-mode 1)

      ;; install iedit 
      (use-package iedit
        :ensure t)
      (require 'iedit)

      ;; Fix iedit bug in Mac
      (define-key global-map (kbd "C-c ;") 'iedit-mode)

      ;; Fixing another key binding bug in iedit mode
      (define-key global-map (kbd "C-c o") 'iedit-mode)

      ;; switch window configuration
      (use-package switch-window
        :ensure t)
      (global-set-key (kbd "C-x w") 'switch-window)


    #+END_SRC
    
*** Clang format
    #+BEGIN_SRC emacs-lisp
      ;; configure clang format
      (use-package clang-format
        :ensure t)
      (require 'clang-format)

      ;; (global-set-key (kbd "C-c i") 'clang-format-region)
      (global-set-key (kbd "C-c u") 'clang-format-buffer)
      (setq clang-format-style-option "Google")

    #+END_SRC
*** Back-up
    #+BEGIN_SRC emacs-lisp
      ;; configure emacs org mode
      (use-package org-bullets
        :ensure t)
      (require 'org-bullets)
      (add-hook 'org-mode-hook (lambda () (org-bullets-mode 1)))

      ;; Backups at .saves folder in the current folder
      (setq backup-by-copying t      ; don't clobber symlinks
            backup-directory-alist
            '(("." . "~/.saves"))    
            delete-old-versions t
            kept-new-versions 6
            kept-old-versions 2
            version-control t)       ; use versioned backups

    #+END_SRC
*** Programming
    #+BEGIN_SRC emacs-lisp
      ;;
      ;; configuration for programming
      ;; 
      '(use-package yasnippet-snippets
         :ensure t)

      (use-package yasnippet
        :ensure t
        :pin melpa)
      (use-package yasnippet-snippets
        :ensure t
        :pin melpa)
      (require 'yasnippet)
      (yas-global-mode 1)

      ;; configure ggtags in c/c++/java mode for faster code navigations.
      (use-package ggtags
        :ensure t)
      (require 'ggtags)
      (add-hook 'c-mode-common-hook
                (lambda ()
                  (when (derived-mode-p 'c-mode 'python-mode 'c++-mode 'java-mode 'Objective-C)
                    (ggtags-mode 1))))
    #+END_SRC
    
*** Auto completion
    #+BEGIN_SRC emacs-lisp
      (use-package auto-complete
        :ensure t
        :pin melpa)
      (use-package auto-complete-c-headers
        :ensure t)
      (require 'auto-complete-config)
      (ac-config-default)
      ;; let's define a function which initializes auto-complete-c-headers and gets called for c/c++ hooks
      (defun my:ac-c-header-init ()
        (require 'auto-complete-c-headers)
        (add-to-list 'ac-sources 'ac-source-c-headers)
        (add-to-list 'achead:include-directories '"
        /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/include/c++/v1
        /usr/local/include
        /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib/clang/9.0.0/include
        /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/include
        /usr/include
        /System/Library/Frameworks
        /Library/Frameworks
        ")
        )

      ;; now let's call this function from c/c++ hooks
      (add-hook 'c++-mode-hook 'my:ac-c-header-init)
      (add-hook 'c-mode-hook 'my:ac-c-header-init)

      (use-package auto-complete-clang
        :ensure t
        :pin melpa)

      (require 'auto-complete-clang)
      (setq ac-auto-start nil)
      (setq ac-quick-help-delay 0.5)
      ;; (ac-set-trigger-key "TAB")
      ;; (define-key ac-mode-map  [(tab)] 'auto-complete)
      (define-key ac-mode-map  [(tab)] 'auto-complete)
      (defun my-ac-config ()
        (setq-default ac-sources '(ac-source-abbrev ac-source-dictionary ac-source-words-in-same-mode-buffers))
        (add-hook 'emacs-lisp-mode-hook 'ac-emacs-lisp-mode-setup)
        ;; (add-hook 'c-mode-common-hook 'ac-cc-mode-setup)
        (add-hook 'ruby-mode-hook 'ac-ruby-mode-setup)
        (add-hook 'css-mode-hook 'ac-css-mode-setup)
        (add-hook 'auto-complete-mode-hook 'ac-common-setup)
        (global-auto-complete-mode))
      (defun my-ac-cc-mode-setup ()
        (setq ac-sources (append '(ac-source-clang ac-source-yasnippet) ac-sources)))
      (add-hook 'c-mode-common-hook 'my-ac-cc-mode-setup)
      ;; ac-source-gtags
      (my-ac-config)

      (setq ac-clang-flags
            (mapcar (lambda (item)(concat "-I" item))
                    (split-string
                     "
               /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/include/c++/v1
               /usr/local/include
               /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib/clang/9.0.0/include
               /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/include
               /usr/include
               /System/Library/Frameworks
               /Library/Frameworks
                "
                     )))

      ;; open header files in cc mode
      (add-to-list 'auto-mode-alist '("\\.h\\'" . c++-mode))

      ;; -i gets alias definitions from .bash_profile
      (setq shell-command-switch "-ic")

      ;; Don't make new frames when opening a new file with Emacs
      (setq ns-pop-up-frames nil)

      (use-package smooth-scrolling
        :ensure t)
      (smooth-scrolling-mode)

    #+END_SRC
    
*** Neo tree
    #+BEGIN_SRC emacs-lisp
      ;;;; Enable neo tree view by default
      ;; (use-package neotree
      ;;   :ensure t)
      ;; (require 'neotree)
      ;; (setq-default neo-theme 'plusminus)
      ;; (neotree-toggle)
      ;;;; (setq neo-window-fixed-size nil)
      ;; (setq neo-smart-open t)
      ;; (setq neo-hidden-regexp-list '("^\\." "\\.cs\\.meta$" "\\.pyc$" "~$" "^#.*#$" "\\.elc$" "\\.o$"))
      ;; (global-set-key [f8] 'neotree-toggle)
    #+END_SRC

*** Compile .emacs.d/
    Precompile all the *.el files for faster loading of emacs. But make sure *.elc files aren't stale. If you change *.el files in user directory
    be sure to run M-x byte-compile-init-dir. Emacs will prefer *.elc files over *.el files.

    #+BEGIN_SRC emacs-lisp
      (defun byte-compile-init-dir ()
        "Byte-compile all your dotfiles."
        (interactive)
        (byte-recompile-directory user-emacs-directory 0))

      ;; Don't call byte compile here. It will compile every single time emacs is loaded.
      ;; which defeats the purpose. call it only once.
      ;; (byte-compile-init-dir)
    #+END_SRC

*** Google C/C++ style 
    #+BEGIN_SRC emacs-lisp
      ;; Google C/C++ style
      (use-package google-c-style
        :ensure t)
      (require 'google-c-style)
      (add-hook 'c-mode-common-hook 'google-set-c-style)
      (add-hook 'c-mode-common-hook 'google-make-newline-indent)
    #+END_SRC
    
*** CMake mode
    #+BEGIN_SRC emacs-lisp
      (use-package cmake-mode
        :ensure t)
    #+END_SRC
    
*** Multi term
    #+BEGIN_SRC emacs-lisp
      (use-package multi-term
        :ensure t)
      (setq multi-term-program "/bin/bash")
    #+END_SRC
    
*** Multiple cursors
    #+BEGIN_SRC emacs-lisp
      (use-package multiple-cursors
        :ensure t)
      (require 'multiple-cursors)
      (global-set-key (kbd "C->") 'mc/mark-next-like-this)
      (global-set-key (kbd "C-<") 'mc/mark-previous-like-this)
      (global-set-key (kbd "C-c C-<") 'mc/mark-all-like-this)

    #+END_SRC

*** Empty lines indicator
    #+BEGIN_SRC emacs-lisp
      (set-default 'indicate-empty-lines t)
    #+END_SRC

*** Compile kbd binding
    #+BEGIN_SRC emacs-lisp
      (global-set-key(kbd "C-c C-m") 'compile)
    #+END_SRC
    
*** Org mode
    #+BEGIN_SRC emacs-lisp
      (use-package org
        :ensure t)
      (require 'org)
    #+END_SRC

*** Unclutter modeline
    #+BEGIN_SRC emacs-lisp
      (use-package diminish
        :ensure t)
      (require 'diminish)
      (diminish 'projectile-mode)
      (diminish 'abbrev-mode)
      (diminish 'ivy-mode)
      (diminish 'visual-line-mode)
      (diminish 'auto-revert-mode)
      (diminish 'autopair-mode)
    #+END_SRC

*** Avy jump mode
    Ace jump mode is dead. use Avy instead.
    #+BEGIN_SRC emacs-lisp
      (use-package avy
        :ensure t)
      (require 'avy)
      (global-set-key (kbd "C-:") 'avy-goto-char)
      (global-set-key (kbd "M-g f") 'avy-goto-line)
    #+END_SRC
    
*** Bazel mode
    #+BEGIN_SRC emacs-lisp
      (use-package bazel-mode
	:ensure t)
      (require 'bazel-mode)
    #+END_SRC

*** Save minibuffer history
    #+BEGIN_SRC emacs-lisp
      (savehist-mode t)
      (setq savehist-file "~/.emacs.d/savehist")
    #+END_SRC

*** Hideshow mode
    #+BEGIN_SRC emacs-lisp
      (add-hook 'prog-mode-hook #'hs-minor-mode)
    #+END_SRC

*** Markdown mode		
    #+BEGIN_SRC emacs-lisp		
      (use-package markdown-mode		
	:ensure t		
	:commands (markdown-mode gfm-mode)		
	:mode (("README\\.md\\'" . gfm-mode)		
	       ("\\.md\\'" . markdown-mode)		
	       ("\\.markdown\\'" . markdown-mode))		
	:init (setq markdown-command "multimarkdown"))		
    #+END_SRC

*** Java mode
    Java uses 4 space indentation and Emacs by default uses 2. 
    #+BEGIN_SRC emacs-lisp
      (add-hook 'java-mode-hook (lambda ()
				      (setq c-basic-offset 4
					    tab-width 4
					    indent-tabs-mode t)))
    #+END_SRC

*** Plant UML mode
    #+BEGIN_SRC emacs-lisp
      (use-package plantuml-mode
	:ensure t)
      ;; Enable plantuml-mode for PlantUML files
      (add-to-list 'auto-mode-alist '("\\.plantuml\\'" . plantuml-mode))

      ;; plantuml preview needs plantuml.jar (C-c C-c)
      (setq plantuml-jar-path "~/.emacs.d/vendor/bin/plantuml.jar")
    #+END_SRC

*** Expand region 
    #+BEGIN_SRC emacs-lisp
      (use-package expand-region
	:ensure t)
      (require 'expand-region)
      (global-set-key (kbd "C-=") 'er/expand-region)
    #+END_SRC

*** Haskell mode
    #+BEGIN_SRC emacs-lisp
      (use-package haskell-mode
	:ensure t)
    #+END_SRC

*** Breadcrumbs
    #+BEGIN_SRC emacs-lisp
      (load "~/.emacs.d/vendor/breadcrumb")
      (require 'breadcrumb)
      (global-set-key (kbd "s-SPC")         'bc-set)            ;; shift-SPACE for set bookmark
      (global-set-key [(meta j)]              'bc-previous)       ;; M-j for jump to previous
      (global-set-key [(shift meta j)]        'bc-next)           ;; Shift-M-j for jump to next
      (global-set-key [(meta up)]             'bc-local-previous) ;; M-up-arrow for local previous
      (global-set-key [(meta down)]           'bc-local-next)     ;; M-down-arrow for local next
      (global-set-key [(control c)(j)]        'bc-goto-current)   ;; C-c j for jump to current bookmark
      (global-set-key [(control x)(meta j)]   'bc-list)           ;; C-x M-j for the bookmark menu list
    #+END_SRC

*** Rust mode
    #+BEGIN_SRC emacs-lisp
      (use-package rust-mode
	:ensure t)
    #+END_SRC
    
*** yaml mode
    #+BEGIN_SRC emacs-lisp
      (use-package yaml-mode
	:ensure t)
    #+END_SRC
    
*** Swift mode
    #+BEGIN_SRC emacs-lisp
      (use-package swift3-mode
	:ensure t)
    #+END_SRC
